/*
  * GetTweets v@VERSION
  *
  * A jQuery plugin to retrieve tweets from multiple users
  *
  * https://github.com/a-am/jquery-gettweets
  *
  * Copyright 2013 by Adam Randlett
    * Released under the MIT License
    * http://en.wikipedia.org/wiki/MIT_License
*/
(function(e){e.fn.getTweets=function(t,n){var r={twitter_timeline_url:"timeline_response.php",twitter_search_url:"search_response.php",twitter_rate_limit_url:"rate_limit_status_response.php",twitter_users:[],twitter_queries:[],_isSearch:false,format:"json",howmany:4,retweets:false,no_replies:false,rate_limit_status:false,tweetstring:"<div class='tweet'><div class='header'><p class='summary'>{tweettext}</p><p class='meta'>{tweetdate} by <a href='http://twitter.com/{tweetuser:screenname}'>{tweetuser:name}</a></p></div> <div class='image'><a href='http://twitter.com/{tweetuser:screenname}'><img src='{tweetuser:image}' width='48' height='48'></a></div></div>",retweetstring:"<div class='tweet'><div class='header'><p class='summary'>{tweettext}</p><p class='meta'>{tweetdate} <a href='http://twitter.com/{retweetuser:screenname}'>{retweetuser:name}</a> <span class='rt'>retweeted</span> by <a href='http://twitter.com/{tweetuser:screenname}'>{tweetuser:name}</a> </p></div> <div class='image'><a href='http://twitter.com/{tweetuser:screenname}'><img src='{retweetuser:image}' width='48' height='48'></a></div></div>"};var i=e.extend(r,t);return this.each(function(){function u(e){var t=e.split(" ");var e=i._isSearch?t[2]+" "+t[1]+", "+t[3]+" "+t[4]:t[1]+" "+t[2]+", "+t[5]+" "+t[3];var n=Date.parse(e);var r=arguments.length>1?arguments[1]:new Date;var s=parseInt((r.getTime()-n)/1e3);s=s+r.getTimezoneOffset()*60;if(s<60){return"less than a minute ago"}else if(s<120){return"about a minute ago"}else if(s<60*60){return parseInt(s/60).toString()+" minutes ago"}else if(s<120*60){return"about an hour ago"}else if(s<24*60*60){return"about "+parseInt(s/3600).toString()+" hours ago"}else if(s<48*60*60){return"1 day ago"}else{return parseInt(s/86400).toString()+" days ago"}}function a(t){e.each(t,function(e,t){if(t.text!==undefined){var n=t.text,o;if(i._isSearch){o={"{tweetdate}":u(t.created_at),"{tweeturl}":"http://www.twitter.com/"+t.from_user_name+"/status/"+t.id_str,"{tweettext}":n.parseUrl().parseUsername().parseEmail().parseHashtag(),"{tweetuser:name}":t.from_user_name,"{tweetuser:screenname}":t.from_user,"{tweetuser:url}":t.user.url,"{tweetuser:image}":t.user.profile_image_url}}else{o={"{tweetdate}":u(t.created_at),"{tweeturl}":"http://www.twitter.com/"+t.user.screen_name+"/status/"+t.id_str,"{tweettext}":n.parseUrl().parseUsername().parseEmail().parseHashtag(),"{tweetuser:name}":t.user.name,"{tweetuser:screenname}":t.user.screen_name,"{tweetuser:location}":t.user.location,"{tweetuser:description}":t.user.description,"{tweetuser:url}":t.user.url,"{tweetuser:image}":t.user.profile_image_url,"{tweetsource}":t.source}}var a,f;if(t.retweeted_status){o["{retweetuser:name}"]=t.retweeted_status.user.name;o["{retweetuser:screenname}"]=t.retweeted_status.user.screen_name;o["{retweetuser:image}"]=t.retweeted_status.user.profile_image_url;f=r.retweetstring}else{f=r.tweetstring}var a=f.multiReplace(o);s.push({id:t.id,status:a})}})}function f(){s.sort(function(e,t){return t.id-e.id});twitter_count=s.length;for(var e=0,i=r.howmany;e<i;e++){t.append(s[e].status)}if(typeof n=="function"){n.call(this)}}function l(t){e.getJSON(i.twitter_rate_limit_url,function(e){console.log("-------------------------------------------------------");console.log("RATE LIMIT STATUS");console.log("  User Timeline Limit: "+e.resources.statuses["/statuses/user_timeline"].limit);console.log("  User Timeline Remaining: "+e.resources.statuses["/statuses/user_timeline"].remaining);console.log("  -----  ");console.log("  Search Tweets Limit: "+e.resources.search["/search/tweets"].limit);console.log("  Search Tweets Remaining: "+e.resources.search["/search/tweets"].remaining);console.log("-------------------------------------------------------")})}function c(t){if(r.twitter_queries.length>0){i._isSearch=true;e.ajax({dataType:"json",url:i.twitter_search_url+"?q="+encodeURIComponent(r.twitter_queries[t])+"&include_entities=true"+"&count="+r.howmany,timeout:1e3,type:"GET",async:false,crossDomain:false,error:function(){},success:function(e){a(e.statuses)},complete:function(){if(t<r.twitter_queries.length-1){c(++t)}else{f()}}})}else{e.ajax({dataType:"json",url:i.twitter_timeline_url+"?screen_name="+r.twitter_users[t]+"&include_rts="+r.retweets+"&exclude_replies="+r.replies+"&count="+r.howmany,timeout:1e3,type:"GET",async:false,crossDomain:false,error:function(){},success:function(e){a(e)},complete:function(){if(t<r.twitter_users.length-1){c(++t)}else{f()}}})}}var t=e(this),r={twitter_timeline_url:i.twitter_timeline_url,twitter_search_url:i.twitter_search_url,twitter_rate_limit_url:i.twitter_rate_limit_url,twitter_users:i.twitter_users,twitter_queries:i.twitter_queries,howmany:i.howmany,tweetstring:i.tweetstring,retweetstring:i.retweetstring,retweets:i.retweets,no_replies:i.no_replies,rate_limit_status:i.rate_limit_status},s=[],o;String.prototype.parseUrl=function(){var e=new RegExp(/[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/gi);return this.replace(e,function(e){return'<a href="'+e+'">'+e+"</a>"})};String.prototype.parseUsername=function(){return this.replace(new RegExp(/[@]+[A-Za-z0-9-_]+/g),function(e){var t=e.replace("@","");return e.link("http://twitter.com/"+t)})};String.prototype.parseEmail=function(){var e=new RegExp(/([A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4})/gi);return this.replace(e,function(e){return'<a href="mailto:'+e+'">'+e+"</a>"})};String.prototype.parseHashtag=function(){return this.replace(new RegExp(/[#]+[A-Za-z0-9-_]+/g),function(e){var t=e.replace("#","%23");return e.link("http://search.twitter.com/search?q="+t)})};String.prototype.multiReplace=function(e){var t=this,n;for(n in e){t=t.replace(new RegExp(n,"g"),e[n])}return t};Storage.prototype.setObject=function(e,t){this.setItem(e,JSON.stringify(t))};Storage.prototype.getObject=function(e){return JSON.parse(this.getItem(e))};if(r.rate_limit_status){l()}c(0)})}})(jQuery)